(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,i){this.model=e,this.view=t,this.emitter=i}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2),o=i(3),l=i(5);i(10);const a=new s;new l.default(new o.default(a),null,a)},,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(4);class o extends s.default{constructor(e){super(e),this.dataset="2065BAP",this.overlay=new Set(["cma","city","lrt"]),this.purpose=new Set(["all"]),this.time=new Set(["all"]),this.controlsHidden=!1,this.helpOpen=!1,this.currentTime="1",this.animating=!1,this.animationInterval=void 0,this.timeSequence=new Map([["1","21"],["21","22"],["22","23"],["23","3"],["3","41"],["41","42"],["42","43"],["43","5"],["5","6"],["6","1"]]),this.dataDrivenPurposeColours=["match",["get","purp"],"O","#FF0000","W","#FFA500","S","#FFFF00","P","#ADFF2F","H","#008000","T","#20B2AA","L","#0000FF","R","#9932CC","C","#FF1493","Q","#8B4513","#000000"],this.purposeToColourIndex={O:3,W:5,S:7,P:9,H:11,T:13,L:15,R:17,C:19,Q:21},this.colours={purpose:{dataDriven:this.dataDrivenPurposeColours,all:"#FFFFFF",O:"#FF0000",W:"#FFA500",S:"#FFFF00",P:"#ADFF2F",H:"#008000",T:"#20B2AA",L:"#0000FF",R:"#9932CC",C:"#FF1493",Q:"#8B4513"},overlay:{cma:"#9932CC",city:"#0000FF",nc:"#FFFF00",lrt:"#FF1493"}},this.collapsed={dataset:!1,purpose:!1,overlay:!1,time:!1}}initialDraw(){this.dispatchSettingsUpdated(),this.emitter.emit("helpUpdated",this.helpOpen)}updateDataset(e){this.dataset=e,this.dispatchSettingsUpdated()}updatePurpose(e){this.purpose=o.updateStringSet(this.purpose,e),this.dispatchSettingsUpdated()}updateOverlay(e){this.overlay.has(e)?this.overlay.delete(e):this.overlay.add(e),this.dispatchSettingsUpdated()}updateTime(e){this.time=o.updateStringSet(this.time,e),this.dispatchSettingsUpdated()}static updateStringSet(e,t){return"all"===t?e.has("all")?e.delete("all"):e=new Set(["all"]):e.has("all")?e=new Set([t]):e.has(t)?e.delete(t):e.add(t),e}updateColours(e,t,i){const s=this.colours[e];"purpose"===e?"all"===t?s.all=i:(s[t]=i,this.dataDrivenPurposeColours[this.purposeToColourIndex[t]]=i,s.dataDriven=this.dataDrivenPurposeColours):s[t]=i,this.dispatchSettingsUpdated()}toggleAnimation(){this.animating?(this.animating=!1,window.clearInterval(this.animationInterval)):(this.animating=!0,this.time.clear(),this.currentTime="1",this.animationInterval=window.setInterval(()=>{this.currentTime=this.timeSequence.get(this.currentTime),this.time.clear(),this.updateTime(this.currentTime)},1e3),this.dispatchSettingsUpdated())}toggleHide(){this.controlsHidden=!this.controlsHidden,this.dispatchSettingsUpdated()}toggleHelp(){this.helpOpen=!this.helpOpen,this.emitter.emit("helpUpdated",this.helpOpen)}toggleCollapse(e){this.collapsed[e]=!this.collapsed[e],this.emitter.emit("collapsedUpdated",this.collapsed)}dispatchSettingsUpdated(){this.emitter.emit("settingsUpdated",{dataset:this.dataset,purpose:this.purpose,overlay:this.overlay,time:this.time,animating:this.animating,hidden:this.controlsHidden,colours:this.colours})}}t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.emitter=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),o=i(6),l=i(9);class a extends s.default{constructor(e,t,i){super(e,t,i),this.mapView=new o.default(document.getElementById("map"),this.emitter),new l.default(this.model,this.mapView,this.emitter),this.emitter.on("settingsUpdated",({dataset:e,purpose:t,overlay:i,time:s,animating:o,colours:l})=>{this.mapView.draw(e,t,i,s,o,l)}),this.emitter.on("helpUpdated",e=>{o.default.drawHelp(e)}),this.emitter.on("collapsedUpdated",e=>{this.mapView.drawCollapsed(e)})}}t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(7),o=i(8);class l extends o.default{constructor(e,t){super(e,t),this.layers=[],this.overlays=[],this.datasetEntries=document.querySelectorAll(".dataset-entry"),this.datasetCollapse=document.getElementById("collapse-dataset"),this.purposeEntries=document.querySelectorAll(".purpose-entry"),this.colourChoices=document.getElementById("colour-choices"),this.purposeCollapse=document.getElementById("collapse-purpose"),this.overlayEntries=document.querySelectorAll(".overlay-entry"),this.helpIcon=document.getElementById("help-icon"),this.timeEntries=document.querySelectorAll(".time-entry"),this.hideButton=document.getElementById("hide-controls-button"),this.overlayCollapse=document.getElementById("collapse-overlay"),this.help=document.getElementById("help"),this.timeCollapse=document.getElementById("collapse-time"),this.closeHelp=document.getElementById("close-help"),this.colourChoicesCover=document.getElementById("colour-choices-cover"),document.querySelectorAll(".dataset-entry").forEach(e=>{this.layers.push(e.dataset.value)}),document.querySelectorAll(".overlay-entry").forEach(e=>{this.overlays.push(e.dataset.value)}),this.initializeDatasetControl(),this.initializePurposeControl(),this.initializeOverlayControl(),this.initializeTimeControl(),this.initializeHide(),this.initializeColourChooser(),this.initializeHelp(),s.accessToken="pk.eyJ1IjoidGhvbWFzbG9yaW5jeiIsImEiOiJjamx5aXVwaHAxamZzM3dsaWdkZ3Q2eGJyIn0.mXjlp9c3l2-NBoS1uaEUdw";this.map=new s.Map({container:"map",style:"mapbox://styles/thomaslorincz/cjx0png073khh1cpap7m6449e",bounds:[[-115.11466,53.04465],[-112.16116,54.06214]],attributionControl:!1,dragRotate:!1,pitchWithRotate:!1}).addControl(new s.AttributionControl({customAttribution:'<a href="https://github.com/thomaslorincz" rel="noopener" target="_blank">Developed by Thomas Lorincz<a/>'})),this.map.on("load",()=>{this.map.addLayer({id:"2065BAP",source:{type:"vector",url:"mapbox://thomaslorincz.b38h0wik"},"source-layer":"output_2065BAP_300-2jb2ha",type:"circle",paint:{"circle-radius":["interpolate",["linear"],["zoom"],9,["max",.1,["/",["to-number",["get","count"]],300]],12,["max",1,["*",2,["/",["to-number",["get","count"]],300]]]]}}),this.map.addLayer({id:"2065CityII",source:{type:"vector",url:"mapbox://thomaslorincz.4qfirexj"},"source-layer":"output_2065CityII_300-7gjcgt",type:"circle",paint:{"circle-radius":["interpolate",["linear"],["zoom"],9,["max",.1,["/",["to-number",["get","count"]],300]],12,["max",1,["*",2,["/",["to-number",["get","count"]],300]]]]}}),this.map.addLayer({id:"cma",source:{type:"vector",url:"mapbox://thomaslorincz.1kz18y39"},"source-layer":"cma_boundary-5vtklc",type:"line",paint:{"line-width":2}}),this.map.addLayer({id:"city",source:{type:"vector",url:"mapbox://thomaslorincz.48okpw5t"},"source-layer":"city_boundary-d6ewoz",type:"line",paint:{"line-width":2}}),this.map.addLayer({id:"nc",source:{type:"vector",url:"mapbox://thomaslorincz.d571qaco"},"source-layer":"nc_CityII-axaip8",type:"line",paint:{"line-width":2}}),this.map.addLayer({id:"lrt",source:{type:"vector",url:"mapbox://thomaslorincz.75obfmea"},"source-layer":"lrt_2065-0kp6p1",type:"line",paint:{"line-width":2}}),this.emitter.emit("loaded")})}initializeDatasetControl(){this.datasetEntries.forEach(e=>{e.addEventListener("click",e=>{e.target instanceof HTMLElement&&this.emitter.emit("datasetClicked",e.target.dataset.value)})}),this.datasetCollapse.addEventListener("click",()=>{this.emitter.emit("toggleCollapse","dataset")})}initializePurposeControl(){this.purposeEntries.forEach(e=>{e.addEventListener("click",e=>{e.target instanceof HTMLElement&&this.emitter.emit("purposeClicked",e.target.dataset.value)}),e.addEventListener("contextmenu",t=>{t.preventDefault(),this.colourChoices.classList.remove("square-choices"),this.colourChoices.classList.add("circle-choices"),this.colourChoices.setAttribute("category","purpose"),this.drawColourChoices(t,e)})}),this.purposeCollapse.addEventListener("click",()=>{this.emitter.emit("toggleCollapse","purpose")})}initializeOverlayControl(){this.overlayEntries.forEach(e=>{e.addEventListener("click",e=>{e.target instanceof HTMLElement&&this.emitter.emit("overlayClicked",e.target.dataset.value)}),e.addEventListener("contextmenu",t=>{t.preventDefault(),this.colourChoices.classList.remove("circle-choices"),this.colourChoices.classList.add("square-choices"),this.colourChoices.setAttribute("category","overlay"),this.drawColourChoices(t,e)})}),this.overlayCollapse.addEventListener("click",()=>{this.emitter.emit("toggleCollapse","overlay")})}initializeTimeControl(){this.timeEntries.forEach(e=>{e.addEventListener("click",e=>{e.target instanceof HTMLElement&&this.emitter.emit("timeClicked",e.target.dataset.value)})}),this.timeCollapse.addEventListener("click",()=>{this.emitter.emit("toggleCollapse","time")}),document.getElementById("time-animate").addEventListener("click",()=>{this.emitter.emit("time-animate-clicked")})}initializeHide(){this.hideButton.addEventListener("click",()=>{this.emitter.emit("hideClicked")})}initializeColourChooser(){this.colourChoices.querySelectorAll(".colour-choice-icon").forEach(e=>{e.addEventListener("click",()=>{this.hideColourChoices(),this.emitter.emit("colourClicked",{category:this.colourChoices.dataset.category,key:this.colourChoices.dataset.value,value:getComputedStyle(e).backgroundColor})}),this.colourChoices.appendChild(e)}),this.colourChoicesCover.addEventListener("click",()=>{this.hideColourChoices()})}initializeHelp(){this.helpIcon.addEventListener("click",()=>{this.emitter.emit("helpClicked")}),this.help.addEventListener("click",e=>{e.target===document.getElementById("help")&&this.emitter.emit("helpClicked")}),this.closeHelp.addEventListener("click",()=>{this.emitter.emit("helpClicked")})}draw(e,t,i,s,o,l){this.applyColours(t,l),this.drawDataset(e),this.drawPurpose(t),this.drawOverlay(i),this.drawTime(s,o),this.drawDots(e,t,s)}applyColours(e,t){document.querySelectorAll(".purpose-entry").forEach(e=>{const i=e.querySelector(".left-control-icon");i instanceof HTMLElement&&(i.style.backgroundColor=t.purpose[e.dataset.value])}),this.layers.forEach(i=>{e.has("all")?this.map.setPaintProperty(i,"circle-color",t.purpose.all):this.map.setPaintProperty(i,"circle-color",t.purpose.dataDriven)}),this.overlays.forEach(e=>{this.map.setPaintProperty(e,"line-color",t.overlay[e])}),document.querySelectorAll(".overlay-entry").forEach(e=>{const i=e.querySelector(".left-control-icon");i instanceof HTMLElement&&(i.style.backgroundColor=t.overlay[e.dataset.value])})}drawDataset(e){this.layers.forEach(e=>{this.map.setLayoutProperty(e,"visibility","none")}),this.map.setLayoutProperty(e,"visibility","visible"),document.querySelectorAll(".dataset-entry").forEach(e=>{e.classList.remove("selected"),e.querySelector(".left-control-icon").textContent="radio_button_unchecked"}),document.getElementById(`data-${e}`).classList.add("selected"),document.querySelector(".dataset-entry.selected").querySelector(".left-control-icon").textContent="radio_button_checked"}drawPurpose(e){document.querySelectorAll(".purpose-entry.selected").forEach(e=>{e.classList.remove("selected")}),e.has("all")?document.getElementById("purpose-all").classList.add("selected"):e.forEach(e=>{document.getElementById(`purpose-${e}`).classList.add("selected")}),document.querySelectorAll(".purpose-entry").forEach(e=>{if(e.classList.contains("selected")){e.querySelector(".left-control-checkbox").textContent="check_box"}else{e.querySelector(".left-control-checkbox").textContent="check_box_outline_blank"}})}drawOverlay(e){this.overlays.forEach(e=>{this.map.setLayoutProperty(e,"visibility","none")}),document.querySelectorAll(".overlay-entry.selected").forEach(e=>{e.classList.remove("selected")}),e.forEach(e=>{document.getElementById(`overlay-${e}`).classList.add("selected"),this.map.setLayoutProperty(e,"visibility","visible")}),this.overlayEntries.forEach(e=>{if(e.classList.contains("selected")){e.querySelector(".left-control-checkbox").textContent="check_box"}else{e.querySelector(".left-control-checkbox").textContent="check_box_outline_blank"}})}drawTime(e,t){document.querySelectorAll(".time-entry.selected").forEach(e=>{e.classList.remove("selected")}),e.has("all")?document.getElementById("time-all").classList.add("selected"):e.forEach(e=>{document.getElementById(`time-${e}`).classList.add("selected")}),this.timeEntries.forEach(e=>{if(e.classList.contains("selected")){e.querySelector(".left-control-checkbox").textContent="check_box"}else{e.querySelector(".left-control-checkbox").textContent="check_box_outline_blank"}}),t?document.getElementById("time-animate").classList.add("selected"):document.getElementById("time-animate").classList.remove("selected")}drawDots(e,t,i){if(i.has("all")&&t.has("all"))this.map.setFilter(e,null);else if(i.has("all"))this.map.setFilter(e,["in","purp",...Array.from(t.values())]);else if(t.has("all")){const t=Array.from(i.values()).map(e=>parseInt(e));this.map.setFilter(e,["in","time",...t])}else{const s=Array.from(i.values()).map(e=>parseInt(e));this.map.setFilter(e,["all",["in","time",...s],["in","purp",...Array.from(t.values())]])}}drawColourChoices(e,t){this.colourChoices.classList.add("visible"),e.target instanceof HTMLElement&&(this.colourChoices.dataset.value=e.target.dataset.value);const i=t.getBoundingClientRect();this.colourChoices.style.top=`${i.top}px`,this.colourChoices.style.left=`${i.right}px`,this.colourChoicesCover.style.display="block"}hideColourChoices(){this.colourChoices.classList.remove("visible"),this.colourChoicesCover.style.display="none"}static drawHelp(e){document.getElementById("help").style.display=e?"flex":"none"}drawCollapsed(e){Object.keys(e).forEach(t=>{const i=document.getElementById(`${t}-content`),s=document.getElementById(`collapse-${t}`);e[t]?(i.classList.add("collapsed"),s.textContent="expand_more"):(i.classList.remove("collapsed"),s.textContent="expand_less")})}}t.default=l},,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.container=e,this.emitter=t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);class o extends s.default{constructor(e,t,i){super(e,t,i),this.emitter.on("loaded",()=>{this.model.initialDraw()}),this.emitter.on("datasetClicked",e=>{this.model.updateDataset(e)}),this.emitter.on("purposeClicked",e=>{this.model.updatePurpose(e)}),this.emitter.on("overlayClicked",e=>{this.model.updateOverlay(e)}),this.emitter.on("timeClicked",e=>{this.model.updateTime(e)}),this.emitter.on("time-animate-clicked",()=>{this.model.toggleAnimation()}),this.emitter.on("hideClicked",()=>{this.model.toggleHide()}),this.emitter.on("colourClicked",({category:e,key:t,value:i})=>{this.model.updateColours(e,t,i)}),this.emitter.on("helpClicked",()=>{this.model.toggleHelp()}),this.emitter.on("toggleCollapse",e=>{this.model.toggleCollapse(e)})}}t.default=o},function(e,t,i){}],[[1,1,2]]]);